name: Auto Codex Sync

permissions:
  contents: write        # ì»¤ë°‹Â·í‘¸ì‹œ í—ˆìš©
  pull-requests: write   # PR ìƒì„± í—ˆìš©

on:
  workflow_dispatch:     # ìˆ˜ë™ ì‹¤í–‰ íŠ¸ë¦¬ê±°

jobs:
  generate-and-pr:
    runs-on: ubuntu-latest

    steps:
      # 1. ì½”ë“œ ë‚´ë ¤ë°›ê¸°
      - uses: actions/checkout@v3

      # 2. Codex API í˜¸ì¶œ
      - name: Codexë¡œ ì½”ë“œ ìƒì„±
        run: |
          curl https://api.openai.com/v1/completions \
            -H "Authorization: Bearer ${{ secrets.OPENAI_API_KEY }}" \
            -H "Content-Type: application/json" \
            -d '{
                  "model": "code-davinci-002",
                  "prompt": "ì—¬ê¸°ì— ì‘ì—… ì§€ì‹œë¬¸ì„ í•œë‘ ë¬¸ì¥ìœ¼ë¡œ ì¨ì£¼ì„¸ìš”",
                  "max_tokens": 500
                }' > generated.txt

      # 3. í´ë” ë§Œë“¤ê³  íŒŒì¼ ì´ë™ (ì—†ì–´ë„ ì‹¤íŒ¨ ì•ˆ í•¨)
      - name: src í´ë” ì¤€ë¹„ & íŒŒì¼ ì´ë™
        run: |
          mkdir -p src
          mv generated.txt src/new_code.js || true

      # 4. ìë™ Pull Request ìƒì„±
      - name: ìë™ìœ¼ë¡œ Pull Request ë§Œë“¤ê¸°
        uses: peter-evans/create-pull-request@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          branch: codex-update-${{ github.run_number }}
          commit-message: "Codex ì—…ë°ì´íŠ¸: ì½”ë“œ ìƒì„±/ìˆ˜ì •"
          title: "ğŸ¤– Codex ìë™ ì—…ë°ì´íŠ¸ PR"
          body: |
            ì´ PRì€ Codexê°€ ìë™ìœ¼ë¡œ ìƒì„±Â·ìˆ˜ì •í•œ ì½”ë“œë¥¼ ë‹´ê³  ìˆìŠµë‹ˆë‹¤.
