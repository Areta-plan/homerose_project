- name: 파일 정리
  run: |
    # 1) src 폴더가 없으면 새로 만든다
    mkdir -p src

    # 2) generated.txt를 이동하는데, 실패해도 무시
    mv generated.txt src/new_code.js || true

permissions:
  contents: write
  pull-requests: write

on:
  workflow_dispatch:

jobs:
  generate-and-pr:
    runs-on: ubuntu-latest
    steps:
      … # 생략

# 수동으로 실행하거나, 원하는 이벤트에 맞춰 바꿔도 됩니다.
on:
  workflow_dispatch:

jobs:
  generate-and-pr:
    runs-on: ubuntu-latest
    steps:
      # 1) 현재 코드 내려받기
      - uses: actions/checkout@v3

      # 2) Codex API 호출해서 코드 생성·수정
      - name: Codex로 코드 생성
        run: |
          curl https://api.openai.com/v1/completions \
            -H "Authorization: Bearer ${{ secrets.OPENAI_API_KEY }}" \
            -H "Content-Type: application/json" \
            -d '{
                  "model": "code-davinci-002",
                  "prompt": "여기에 작업 지시문을 한두 문장으로 써주세요",
                  "max_tokens": 500
                }' > generated.txt
          mv generated.txt src/new_code.js || true

      # 3) 변경된 파일을 새 브랜치에 커밋하고 PR 만들기
      - name: 자동으로 Pull Request 만들기
        uses: peter-evans/create-pull-request@v4
        with:
          # 브랜치 이름 규칙: codex-update-<숫자>
          branch: codex-update-${{ github.run_number }}
          commit-message: "Codex 업데이트: 코드 생성/수정"
          title: "🤖 Codex 자동 업데이트 PR"
          body: |
            이 PR은 Codex가 자동으로 생성·수정한 코드를 담고 있습니다.
